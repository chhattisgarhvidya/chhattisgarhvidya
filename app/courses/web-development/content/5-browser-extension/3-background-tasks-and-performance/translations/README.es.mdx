---
title: Proyecto de extensiÃ³n del navegador, parte 3: MÃ¡s informaciÃ³n sobre el rendimiento y las tareas en segundo plano
description: "El rendimiento del sitio web se trata de dos cosas: quÃ© tan rÃ¡pido se carga la pÃ¡gina y quÃ© tan rÃ¡pido se ejecuta el cÃ³digo". - [Zack Grossbart](https://www.smashingmagazine.com/2012/06/javascript-profiling-chrome-developer-tools/)
lastUpdated: 2024-12-21T06:11:54.889Z
---

# Proyecto de extensiÃ³n del navegador, parte 3: MÃ¡s informaciÃ³n sobre el rendimiento y las tareas en segundo plano

## [Pre-lecture prueba](https://ashy-river-0debb7803.1.azurestaticapps.net/quiz/27)

### IntroducciÃ³n:

En las dos Ãºltimas lecciones de este mÃ³dulo, aprendiÃ³ cÃ³mo crear un formulario y un Ã¡rea de visualizaciÃ³n para los datos obtenidos de una API. Es una forma muy estÃ¡ndar de crear presencias web en la web. Incluso aprendiÃ³ a manejar la obtenciÃ³n de datos de forma asincrÃ³nica. La extensiÃ³n de su navegador estÃ¡ casi completa.

Queda por administrar algunas tareas en segundo plano, incluida la actualizaciÃ³n del color del icono de la extensiÃ³n, por lo que este es un buen momento para hablar sobre cÃ³mo el navegador administra este tipo de tareas. Pensemos en estas tareas del navegador en el contexto del rendimiento de sus activos web a medida que los crea.

## Conceptos bÃ¡sicos sobre el rendimiento web

> "El rendimiento del sitio web se trata de dos cosas: quÃ© tan rÃ¡pido se carga la pÃ¡gina y quÃ© tan rÃ¡pido se ejecuta el cÃ³digo". - [Zack Grossbart](https://www.smashingmagazine.com/2012/06/javascript-profiling-chrome-developer-tools/)

El tema de cÃ³mo hacer que sus sitios web sean increÃ­blemente rÃ¡pidos en todo tipo de dispositivos, para todo tipo de usuarios, en todo tipo de situaciones, es sorprendentemente vasto. Estos son algunos puntos que debe tener en cuenta al crear un proyecto web estÃ¡ndar o una extensiÃ³n de navegador.

Lo primero que debe hacer para asegurarse de que su sitio funcione de manera eficiente es recopilar datos sobre su rendimiento. El lugar para hacer esto es en las herramientas de desarrollo de su navegador web. En Edge, puede seleccionar los tres puntos en la parte superior derecha del navegador, luego navegar a MÃ¡s herramientas> Herramientas de desarrollo y abrir la pestaÃ±a Rendimiento.

La pestaÃ±a Rendimiento contiene una herramienta de creaciÃ³n de perfiles. Abra un sitio web (pruebe, por ejemplo, https://www.microsoft.com) y haga clic en el botÃ³n 'Grabar', luego actualice el sitio. Detenga la grabaciÃ³n en cualquier momento y podrÃ¡ ver las rutinas que se generan para 'escribir', 'renderizar' y 'pintar' el sitio:

![Edge profiler](./images/profiler.png)

âœ… Visite la [DocumentaciÃ³n de Microsoft](https://docs.microsoft.com/microsoft-edge/devtools-guide/performance/?WT.mc_id=academic-77807-sagibbon) en el panel Rendimiento en Edge

> Consejo: para obtener una lectura real de la hora de inicio de su sitio web, borre la memoria cachÃ© de su navegador

Seleccione elementos de la lÃ­nea de tiempo del perfil para ampliar los eventos que suceden mientras se carga su pÃ¡gina.

Obtenga una instantÃ¡nea del rendimiento de su pÃ¡gina seleccionando una parte de la lÃ­nea de tiempo del perfil y mirando el panel de resumen:

![InstantÃ¡nea de Edge Profiler](./images/snapshot.png)

Compruebe el panel Registro de eventos para ver si algÃºn evento tardÃ³ mÃ¡s de 15 ms:

![Registro de eventos de Edge](./images/log.png)

âœ… Â¡Conoce a tu perfilador! Abra las herramientas de desarrollo en este sitio y vea si hay cuellos de botella. Â¿CuÃ¡l es el activo de carga mÃ¡s lenta? Â¿El mÃ¡s rÃ¡pido?


## Comprobaciones de perfiles

En general, hay algunas "Ã¡reas problemÃ¡ticas" que todo desarrollador web debe tener en cuenta al crear un sitio, para evitar sorpresas desagradables cuando llegue el momento de implementarlo en producciÃ³n.

**TamaÃ±os de activos**: la Web se ha vuelto 'mÃ¡s pesada' y, por lo tanto, mÃ¡s lenta en los Ãºltimos aÃ±os. Parte de este peso tiene que ver con el uso de imÃ¡genes.

âœ… Busque en el [Archivo de Internet](https://httparchive.org/reports/page-weight) una vista histÃ³rica del peso de la pÃ¡gina y mÃ¡s.

Una buena prÃ¡ctica es asegurarse de que sus imÃ¡genes estÃ©n optimizadas, entregadas con el tamaÃ±o y la resoluciÃ³n adecuados para sus usuarios.

**Recorridos de DOM**: el navegador tiene que construir su Modelo de Objetos de Documento basado en el cÃ³digo que usted escribe, por lo que es de interÃ©s para un buen rendimiento de la pÃ¡gina mantener sus etiquetas al mÃ­nimo, solo usando y estilizando lo que la pÃ¡gina necesita. Hasta este punto, se podrÃ­a optimizar el exceso de CSS asociado con una pÃ¡gina; los estilos que deben usarse solo en una pÃ¡gina no necesitan incluirse en la hoja de estilo principal, por ejemplo.

**JavaScript**: Todo desarrollador de JavaScript debe estar atento a los scripts de 'bloqueo de renderizado' que deben cargarse antes de que el resto del DOM pueda atravesarse y pintarse en el navegador. Considere usar "diferir" con sus scripts en lÃ­nea (como se hace en el mÃ³dulo Terrarium).

âœ… Pruebe algunos sitios en un [sitio web de prueba de velocidad del sitio](https://www.webpagetest.org/) para obtener mÃ¡s informaciÃ³n sobre las comprobaciones comunes que se realizan para determinar el rendimiento del sitio.

Ahora que tiene una idea de cÃ³mo el navegador representa los recursos que le envÃ­a, veamos las Ãºltimas cosas que debe hacer para completar su extensiÃ³n:

### Crea una funciÃ³n para calcular el color

Trabajando en `/ src / index.js`, agregue una funciÃ³n llamada` calculateColor () `despuÃ©s de la serie de variables` const` que estableciÃ³ para obtener acceso al DOM:

```JavaScript
function calculateColor(value) {
	let co2Scale = [0, 150, 600, 750, 800];
	let colors = ['#2AA364', '#F5EB4D', '#9E4229', '#381D02', '#381D02'];

	let closestNum = co2Scale.sort((a, b) => {
		return Math.abs(a - value) - Math.abs(b - value);
	})[0];
	console.log(value + ' is closest to ' + closestNum);
	let num = (element) => element > closestNum;
	let scaleIndex = co2Scale.findIndex(num);

	let closestColor = colors[scaleIndex];
	console.log(scaleIndex, closestColor);

	chrome.runtime.sendMessage({ action: 'updateIcon', value: { color: closestColor } });
}
```

Â¿Que estÃ¡ pasando aqui? Pasa un valor (la intensidad de carbono) de la llamada API que completÃ³ en la Ãºltima lecciÃ³n, y luego calcula quÃ© tan cerca estÃ¡ su valor del Ã­ndice presentado en la matriz de colores. Luego, envÃ­a el valor de color mÃ¡s cercano al tiempo de ejecuciÃ³n de Chrome.

Chrome.runtime tiene [una API](https://developer.chrome.com/extensions/runtime) que maneja todo tipo de tareas en segundo plano, y tu extensiÃ³n aprovecha eso:

> "Utilice la API chrome.runtime para recuperar la pÃ¡gina de fondo, devolver detalles sobre el manifiesto y escuchar y responder a eventos en el ciclo de vida de la aplicaciÃ³n o extensiÃ³n. TambiÃ©n puede utilizar esta API para convertir la ruta relativa de las URL a URL calificadas".

âœ… Si estÃ¡ desarrollando esta extensiÃ³n de navegador para Edge, puede que le sorprenda que estÃ© utilizando una API de Chrome. Las versiones mÃ¡s recientes del navegador Edge se ejecutan en el motor del navegador Chromium, por lo que puede aprovechar estas herramientas.

> Tenga en cuenta que si desea crear un perfil de una extensiÃ³n de navegador, inicie las herramientas de desarrollo desde la propia extensiÃ³n, ya que es su propia instancia de navegador independiente.

### Establecer un color de icono predeterminado

Ahora, en la funciÃ³n `init ()`, configure el Ã­cono en verde genÃ©rico para comenzar nuevamente llamando a la acciÃ³n `updateIcon` de Chrome:


```JavaScript
chrome.runtime.sendMessage({
	action: 'updateIcon',
		value: {
			color: 'green',
		},
});
```
### Llame a la funciÃ³n, ejecute la llamada

A continuaciÃ³n, llame a la funciÃ³n que acaba de crear agregÃ¡ndola a la promesa devuelta por la API C02Signal:

```JavaScript
//let CO2...
calculateColor(CO2);
```

Y finalmente, en `/dist/background.js`, agregue el oyente para estas llamadas de acciÃ³n en segundo plano:

```JavaScript
chrome.runtime.onMessage.addListener(function (msg, sender, sendResponse) {
	if (msg.action === 'updateIcon') {
		chrome.browserAction.setIcon({ imageData: drawIcon(msg.value) });
	}
});
//tomado de la extensiÃ³n Energy Lollipop, Â¡buena caracterÃ­stica!
function drawIcon(value) {
	let canvas = document.createElement('canvas');
	let context = canvas.getContext('2d');

	context.beginPath();
	context.fillStyle = value.color;
	context.arc(100, 100, 50, 0, 2 * Math.PI);
	context.fill();

	return context.getImageData(50, 50, 100, 100);
}
```
En este cÃ³digo, estÃ¡ agregando un oyente para cualquier mensaje que llegue al administrador de tareas de backend. Si se llama 'updateIcon', entonces se ejecuta el siguiente cÃ³digo para dibujar un icono del color adecuado usando la API de Canvas.

âœ… AprenderÃ¡ mÃ¡s sobre la API Canvas en las [lecciones del juego espacial](../../../6-space-game/2-drawing-to-canvas/translations/README.es.md).

Ahora, reconstruya su extensiÃ³n (`npm run build`), actualice y ejecute su extensiÃ³n, y observe el cambio de color. Â¿Es un buen momento para hacer un mandado o lavar los platos? Â¡Ahora lo sabes!

Felicitaciones, ha creado una extensiÃ³n de navegador Ãºtil y ha aprendido mÃ¡s sobre cÃ³mo funciona el navegador y cÃ³mo perfilar su rendimiento.

ğŸš€ DesafÃ­o: Investigue algunos sitios web de cÃ³digo abierto que han existido hace mucho tiempo y, segÃºn su historial de GitHub, vea si puede determinar cÃ³mo se optimizaron a lo largo de los aÃ±os para el rendimiento, si es que lo hicieron. Â¿CuÃ¡l es el punto de dolor mÃ¡s comÃºn?

## [Post-lecture prueba](https://ashy-river-0debb7803.1.azurestaticapps.net/quiz/28)

## RevisiÃ³n y autoestudio

Considere suscribirse a un [boletÃ­n informativo de rendimiento](https://perf.email/)

Investigue algunas de las formas en que los navegadores miden el rendimiento web consultando las pestaÃ±as de rendimiento de sus herramientas web. Â¿Encuentra diferencias importantes?

**Tarea**: [Analizar el rendimiento de un sitio](assignment.md)



export default ({ children }) => <div className="docs-content">{children}</div>;