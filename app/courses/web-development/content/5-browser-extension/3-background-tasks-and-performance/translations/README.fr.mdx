---
title: Projet d'extension de navigateur Partie 3 : En savoir plus sur les tÃ¢ches et les performances en arriÃ¨re-plan
description: "Les performances du site Web dÃ©pendent de deux choses : la vitesse Ã  laquelle la page se charge et la vitesse Ã  laquelle le code s'exÃ©cute dessus." -- [Zack Grossbart](https://www.smashingmagazine.com/2012/06/javascript-profiling-chrome-developer-tools/)
lastUpdated: 2024-12-21T06:11:54.881Z
---

# Projet d'extension de navigateur Partie 3 : En savoir plus sur les tÃ¢ches et les performances en arriÃ¨re-plan

## Quiz prÃ©alable

[Quiz prÃ©alable](https://ashy-river-0debb7803.1.azurestaticapps.net/quiz/27?loc=fr)

### Introduction

Dans les deux derniÃ¨res leÃ§ons de ce module, vous avez appris Ã  crÃ©er un formulaire et une zone d'affichage pour les donnÃ©es extraites d'une API. C'est un moyen trÃ¨s standard de crÃ©er des prÃ©sences Web sur le Web. Vous avez mÃªme appris Ã  gÃ©rer la rÃ©cupÃ©ration de donnÃ©es de maniÃ¨re asynchrone. Votre extension de navigateur est presque terminÃ©e.

Il reste Ã  gÃ©rer certaines tÃ¢ches en arriÃ¨re-plan, dont le rafraÃ®chissement de la couleur de l'icÃ´ne de l'extension, c'est donc le moment idÃ©al pour parler de la faÃ§on dont le navigateur gÃ¨re ce genre de tÃ¢che. Pensons Ã  ces tÃ¢ches de navigateur dans le contexte des performances de vos ressources Web au fur et Ã  mesure que vous les crÃ©ez.

## Notions de base sur les performances Web

> "Les performances du site Web dÃ©pendent de deux choses : la vitesse Ã  laquelle la page se charge et la vitesse Ã  laquelle le code s'exÃ©cute dessus." -- [Zack Grossbart](https://www.smashingmagazine.com/2012/06/javascript-profiling-chrome-developer-tools/)

La question de savoir comment rendre vos sites Web incroyablement rapides sur toutes sortes d'appareils, pour toutes sortes d'utilisateurs, dans toutes sortes de situations, est sans surprise vaste. Voici quelques points Ã  garder Ã  l'esprit lorsque vous crÃ©ez un projet Web standard ou une extension de navigateur.

La premiÃ¨re chose que vous devez faire pour vous assurer que votre site fonctionne efficacement est de collecter des donnÃ©es sur ses performances. Le premier endroit pour le faire est dans les outils de dÃ©veloppement de votre navigateur Web. Dans Edge, vous pouvez sÃ©lectionner le bouton "ParamÃ¨tres et plus" (l'icÃ´ne Ã  trois points en haut Ã  droite du navigateur), puis accÃ©dez Ã  Plus d'outils > Outils de dÃ©veloppement et ouvrez l'onglet Performances. Vous pouvez Ã©galement utiliser les raccourcis clavier `Ctrl` + `Maj` + `I` sur Windows, ou `Option` + `Commande` + `I` sur Mac pour ouvrir les outils de dÃ©veloppement.

L'onglet Performance contient un outil de profilage. Ouvrez un site Web (essayez, par exemple, https://www.microsoft.com) et cliquez sur le bouton 'Record', puis actualisez le site. ArrÃªtez l'enregistrement Ã  tout moment et vous pourrez voir les routines gÃ©nÃ©rÃ©es pour le 'script', le 'render' (rendu), et le 'paint' (l'affichage) du site:

![Edge profiler](../images/profiler.png)

âœ… Consultez la [Documentation Microsoft](https://docs.microsoft.com/microsoft-edge/devtools-guide/performance/?WT.mc_id=academic-77807-sagibbon) Ã  propos du panneau Performances dans Edge

> Astuce : pour avoir une vraie lecture de l'heure de dÃ©marrage de votre site web, videz le cache de votre navigateur

SÃ©lectionnez des Ã©lÃ©ments de la chronologie du profil pour zoomer sur les Ã©vÃ©nements qui se produisent pendant le chargement de votre page.

Obtenez un aperÃ§u des performances de votre page en sÃ©lectionnant une partie de la chronologie du profil et en regardant le volet rÃ©capitulatif :

![Capture du profileur Edge](../images/snapshot.png)

VÃ©rifiez le volet Journal des Ã©vÃ©nements pour voir si un Ã©vÃ©nement a pris plus de 15 ms:

![Journal des Ã©vÃ©nements Edge](../images/log.png)

âœ… Apprenez Ã  connaÃ®tre votre profileur! Ouvrez les outils de dÃ©veloppement sur ce site et voyez s'il y a des goulots d'Ã©tranglement. Quel est l'Ã©lÃ©ment le plus lent? Le plus rapide?

## ContrÃ´les de profilage

En gÃ©nÃ©ral, il existe des "zones Ã  problÃ¨mes" que chaque dÃ©veloppeur Web doit surveiller lors de la crÃ©ation d'un site, afin d'Ã©viter les mauvaises surprises au moment du dÃ©ploiement en production.

**Tailles des Ã©lÃ©ments**: Le Web est devenu 'plus lourd', et donc plus lent, au cours des derniÃ¨res annÃ©es. Une partie de ce poids est liÃ©e Ã  l'utilisation d'images.

âœ… Parcourez les [archives d'Internet](https://httparchive.org/reports/page-weight) pour une vue historique du poids des pages et plus encore.

Une bonne pratique consiste Ã  vous assurer que vos images sont optimisÃ©es, livrÃ©es Ã  la bonne taille et Ã  la bonne rÃ©solution pour vos utilisateurs.

**TraversÃ©es du DOM**: Le navigateur doit construire son modÃ¨le objet de document en fonction du code que vous Ã©crivez, il est donc dans l'intÃ©rÃªt d'une bonne performance de la page de garder vos balises minimales, en utilisant et en stylisant uniquement ce dont la page a besoin. Ã€ ce stade, l'excÃ¨s de CSS associÃ© Ã  une page pourrait Ãªtre optimisÃ© ; les styles qui ne doivent Ãªtre utilisÃ©s que sur une seule page n'ont pas besoin d'Ãªtre inclus dans la feuille de style principale, par exemple.

**JavaScript**: Chaque dÃ©veloppeur JavaScript doit surveiller les scripts 'bloquant le rendu' qui doivent Ãªtre chargÃ©s avant que le reste du DOM puisse Ãªtre parcouru et peint sur le navigateur. Pensez Ã  utiliser `defer` avec vos scripts en ligne (comme cela se fait dans le module Terrarium).

âœ… Essayez certains sites sur un [site Web de test de vitesse de site](https://www.webpagetest.org/) pour en apprendre plus sur les vÃ©rifications courantes qui sont effectuÃ©es pour dÃ©terminer les performances du site.

Maintenant que vous avez une idÃ©e de la faÃ§on dont le navigateur rend les ressources que vous lui envoyez, examinons les derniÃ¨res choses que vous devez faire pour terminer votre extension:

### CrÃ©er une fonction pour calculer la couleur

En travaillant dans `/src/index.js`, ajoutez une fonction appelÃ©e `calculateColor()` aprÃ¨s la sÃ©rie de variables `const` que vous avez dÃ©finies pour accÃ©der au DOM:

```JavaScript
function calculateColor(value) {
	let co2Scale = [0, 150, 600, 750, 800];
	let colors = ['#2AA364', '#F5EB4D', '#9E4229', '#381D02', '#381D02'];

	let closestNum = co2Scale.sort((a, b) => {
		return Math.abs(a - value) - Math.abs(b - value);
	})[0];
	console.log(value + ' is closest to ' + closestNum);
	let num = (element) => element > closestNum;
	let scaleIndex = co2Scale.findIndex(num);

	let closestColor = colors[scaleIndex];
	console.log(scaleIndex, closestColor);

	chrome.runtime.sendMessage({ action: 'updateIcon', value: { color: closestColor } });
}
```

Que se passe t-il ici? Vous transmettez une valeur (l'intensitÃ© carbone) de l'appel d'API que vous avez terminÃ© dans la derniÃ¨re leÃ§on, puis vous calculez Ã  quel point sa valeur est proche de l'indice prÃ©sentÃ© dans le tableau de couleurs. Ensuite, vous envoyez la valeur de couleur la plus proche au moteur d'exÃ©cution Chrome.

Le chrome.runtime a [une API](https://developer.chrome.com/extensions/runtime) qui gÃ¨re toutes sortes de tÃ¢ches en arriÃ¨re-plan, et votre extension en tire parti:

> "Utilisez l'API chrome.runtime pour rÃ©cupÃ©rer la page d'arriÃ¨re-plan, renvoyer des dÃ©tails sur le manifeste, et Ã©couter et rÃ©pondre aux Ã©vÃ©nements dans le cycle de vie de l'application ou de l'extension. Vous pouvez Ã©galement utiliser cette API pour convertir le chemin relatif des URL en URL entiÃ¨rement qualifiÃ©es."

âœ… Si vous dÃ©veloppez cette extension de navigateur pour Edge, vous pourriez Ãªtre surpris d'utiliser une API Chrome. Les nouvelles versions du navigateur Edge s'exÃ©cutent sur le moteur de navigateur Chromium, vous pouvez donc tirer parti de ces outils.

> Notez que si vous souhaitez profiler une extension de navigateur, lancez les outils de dÃ©veloppement Ã  partir de l'extension elle-mÃªme, car il s'agit de sa propre instance de navigateur distincte.

### DÃ©finir une couleur d'icÃ´ne par dÃ©faut

Maintenant, dans la fonction `init()`, dÃ©finissez l'icÃ´ne sur un vert gÃ©nÃ©rique pour commencer en appelant Ã  nouveau l'action `updateIcon` de chrome:

```JavaScript
chrome.runtime.sendMessage({
	action: 'updateIcon',
		value: {
			color: 'green',
		},
});
```
### Appeler la fonction, exÃ©cuter l'appel

Ensuite, appelez cette fonction que vous venez de crÃ©er en l'ajoutant Ã  la promesse renvoyÃ©e par l'API C02Signal:

```JavaScript
//let CO2...
calculateColor(CO2);
```

Et enfin, dans `/dist/background.js`, ajoutez l'Ã©couteur pour ces appels d'action en arriÃ¨re-plan:

```JavaScript
chrome.runtime.onMessage.addListener(function (msg, sender, sendResponse) {
	if (msg.action === 'updateIcon') {
		chrome.browserAction.setIcon({ imageData: drawIcon(msg.value) });
	}
});
//empruntÃ© Ã  l'extension energy lollipop, fonctionnalitÃ© intÃ©ressante !
function drawIcon(value) {
	let canvas = document.createElement('canvas');
	let context = canvas.getContext('2d');

	context.beginPath();
	context.fillStyle = value.color;
	context.arc(100, 100, 50, 0, 2 * Math.PI);
	context.fill();

	return context.getImageData(50, 50, 100, 100);
}
```
Dans ce code, vous ajoutez un Ã©couteur pour tous les messages arrivant au gestionnaire de tÃ¢ches principal. S'il s'appelle 'updateIcon', le code suivant est exÃ©cutÃ© pour dessiner une icÃ´ne de la bonne couleur Ã  l'aide de l'API Canvas.

âœ… Vous en saurez plus sur l'API Canvas dans les [Cours sur le jeu spatial](../../../6-space-game/2-drawing-to-canvas/translations/README.fr.md).

Maintenant, recompiler votre extension (`npm run build`), actualisez et lancez la, et observez le changement de couleur. Est-ce le bon moment pour faire une course ou faire la vaisselle? Vous le savez maintenant!

FÃ©licitations, vous avez crÃ©Ã© une extension de navigateur utile et en avez appris davantage sur le fonctionnement du navigateur et sur la faÃ§on de profiler ses performances.

---

## ğŸš€ Challenge


EnquÃªtez sur certains sites Web open source qui existent depuis longtemps et, sur la base de leur historique GitHub, voyez si vous pouvez dÃ©terminer comment ils ont Ã©tÃ© optimisÃ©s au fil des ans pour les performances, le cas Ã©chÃ©ant. Quel est le point sensible le plus courant?

## Quiz de validation des connaissances

[Quiz de validation des connaissances](https://ashy-river-0debb7803.1.azurestaticapps.net/quiz/28?loc=fr)

## RÃ©vision et Ã©tude personnelle

Pensez Ã  vous inscrire Ã  une [newsletter sur les performances](https://perf.email/)

Ã‰tudiez certaines des faÃ§ons dont les navigateurs Ã©valuent les performances Web en consultant les onglets de performances de leurs outils Web. Trouvez-vous des diffÃ©rences majeures?

## Affectation

[Analyser un site par rapport Ã  la performance](assignment.fr.md)



export default ({ children }) => <div className="docs-content">{children}</div>;