---
title: å»ºç«‹éŠ€è¡Œç¶²é æ‡‰ç”¨ç¨‹å¼ Part 4ï¼š ç‹€æ…‹æ§ç®¡çš„æ¦‚å¿µ
description: æˆ‘å€‘ç©¶ç«Ÿè¦è§£æ±ºä»€éº¼å•é¡Œï¼Ÿ
lastUpdated: 2024-12-21T06:11:55.477Z
---

# å»ºç«‹éŠ€è¡Œç¶²é æ‡‰ç”¨ç¨‹å¼ Part 4ï¼š ç‹€æ…‹æ§ç®¡çš„æ¦‚å¿µ

## èª²å‰æ¸¬é©—

[èª²å‰æ¸¬é©—](https://ashy-river-0debb7803.1.azurestaticapps.net/quiz/47?loc=zh_tw)

### å¤§ç¶±

éš¨è‘—ç¶²é æ‡‰ç”¨è¶Šä¾†è¶Šé¾å¤§ï¼Œè¿½è¹¤è³‡æ–™æµçš„å‹•å‘ä¹Ÿæ˜¯ä¸€ç¨®æŒ‘æˆ°ã€‚ç¨‹å¼å–å¾—äº†ä½•ç¨®è³‡æ–™ã€ç¶²é å¦‚ä½•è™•ç†å®ƒã€ä½•æ™‚ä½•è™•è¢«æ›´æ–°ä¸Šå»â€¦â€¦é€™äº›å¾ˆå®¹æ˜“åœ°å°è‡´ç¨‹å¼ç¢¼å‡Œäº‚è€Œé›£ä»¥ç¶­è­·ã€‚å°¤å…¶æ˜¯ç•¶ä½ éœ€è¦åœ¨ä¸åŒé é¢ä¸Šåšè³‡æ–™å…±äº«æ™‚ï¼Œå¥½æ¯”èªªä½¿ç”¨è€…çš„è³‡æ–™ã€‚*ç‹€æ…‹æ§ç®¡(state management)* çš„è§€å¿µå·²ç¶“å­˜åœ¨æ–¼æ‰€æœ‰ç¨‹å¼ä¸­ï¼Œæˆ‘å€‘ä¹Ÿé–‹å§‹éœ€è¦åœ¨é–‹ç™¼è¤‡é›œçš„ç¶²é æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œæ³¨æ„é€™å€‹é—œéµé»ã€‚

åœ¨é€™å€‹æœ€çµ‚ç« å…§ï¼Œæˆ‘å€‘æœƒç¸½è¦½æ•´å€‹ç¨‹å¼ä¸¦é‡æ–°æ€è€ƒè©²å¦‚ä½•ç®¡ç†ç¨‹å¼ç‹€æ…‹ï¼Œè®“ç€è¦½å™¨èƒ½åœ¨ä»»ä½•æ™‚åˆ»åšé‡æ–°æ•´ç†ï¼Œåœ¨ä¸åŒçš„ä½¿ç”¨è€…éšæ®µç¶­æŒè³‡æ–™çš„ç‹€æ…‹ã€‚

### é–‹å§‹ä¹‹å‰

ä½ éœ€è¦å…ˆå®Œæˆ[å–å¾—è³‡æ–™](../../3-data/translations/README.zh-tw.md)çš„ç¶²é é–‹ç™¼ç« ç¯€ã€‚ä½ é‚„éœ€è¦å®‰è£ [Node.js](https://nodejs.org) ä¸¦æ–¼æœ¬åœ°ç«¯[åŸ·è¡Œä¼ºæœå™¨ API](../../api/translations/README.zh-tw.md)ä»¥ç®¡ç†ä½¿ç”¨è€…è³‡æ–™ã€‚ 

ä½ å¯ä»¥æ¸¬è©¦ä¼ºæœå™¨æ˜¯å¦é‹ä½œæ­£å¸¸ï¼Œåœ¨çµ‚ç«¯æ©Ÿä¸­è¼¸å…¥æŒ‡ä»¤ï¼š

```sh
curl http://localhost:5000/api
# -> should return "Bank API v1.0.0" as a result
```

---

## æ€è€ƒç‹€æ…‹æ§ç®¡

åœ¨[å‰ä¸€å ‚èª²](../../3-data/translations/README.zh-tw.md)ä¸­ï¼Œæˆ‘å€‘ä»‹ç´¹äº†æ‡‰ç”¨ç¨‹å¼åŸºæœ¬çš„ç‹€æ…‹ï¼Œå…¨åŸŸè®Šæ•¸ `account` æä¾›ç™»å…¥å¸³æˆ¶çš„ç›¸é—œéŠ€è¡Œè³‡æ–™ã€‚ç„¶è€Œï¼Œç¾åœ¨çš„å°ˆæ¡ˆå­˜åœ¨è‘—ä¸€äº›ç‘•ç–µã€‚è©¦è‘—åœ¨å„€è¡¨æ¿ä»‹é¢ä¸­é‡æ–°æ•´ç†ã€‚ç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼Ÿ

ç›®å‰æˆ‘å€‘çš„ç¨‹å¼ç¢¼æœ‰ä¸‰å€‹å•é¡Œï¼š

- ç¶²é ç‹€æ…‹ä¸¦æ²’æœ‰è¢«å„²å­˜ï¼Œç•¶ç€è¦½å™¨é‡æ–°æ•´ç†æ™‚ï¼Œæœƒè¢«å°å›ç™»å…¥é é¢ã€‚
- æœ‰è¨±å¤šå‡½å¼æœƒä¿®æ”¹ç¶²é ç‹€æ…‹ã€‚éš¨è‘—æ‡‰ç”¨ç¨‹å¼è®Šå¤§ï¼Œæˆ‘å€‘å¾ˆé›£å»è¿½è¹¤ä¹‹å¾Œçš„æ”¹è®Šï¼Œæ™‚åˆ»åœ°å»æ›´æ–°ç›¸é—œçš„ç¶²é ç‹€æ…‹ã€‚
- ç¶²é ç‹€æ…‹ä¸¦ä¸å®Œæ•´ï¼Œç•¶ä½ *ç™»å‡º*å¸³æˆ¶æ™‚ï¼Œå¸³æˆ¶è³‡è¨Šä»ç„¶é¡¯ç¤ºåœ¨ç™»å…¥é é¢ä¸Šã€‚

æˆ‘å€‘æ˜¯å¯ä»¥é€ä¸€çš„è§£æ±ºé€™äº›å•é¡Œï¼Œä½†é€™æ¨£æœƒå‰µé€ å‡ºè¨±å¤šç¨ç«‹çš„ç¨‹å¼ç¢¼ï¼Œè®“æ‡‰ç”¨ç¨‹å¼æ›´è¤‡é›œè€Œé›£ä»¥å»ç®¡ç†ã€‚æˆ–è€…æ˜¯æˆ‘å€‘åœä¸‹ä¾†æ€è€ƒä¸€ä¸‹æˆ‘å€‘çš„ç­–ç•¥ã€‚

> æˆ‘å€‘ç©¶ç«Ÿè¦è§£æ±ºä»€éº¼å•é¡Œï¼Ÿ

[ç‹€æ…‹æ§ç®¡(State management)](https://en.wikipedia.org/wiki/State_management)å¯ä»¥ç‚ºå…©é …å•é¡Œæä¾›è‰¯å¥½çš„è§£æ±ºæ–¹æ¡ˆï¼š

- å¦‚ä½•è®“æ‡‰ç”¨ç¨‹å¼ä¸­çš„è³‡æ–™æµå®¹æ˜“ç†è§£ï¼Ÿ
- å¦‚ä½•è®“ç¶²é ç‹€æ…‹ä¸€ç›´èˆ‡ä½¿ç”¨è€…ä»‹é¢ï¼Œæˆ–æ˜¯ç›¸é—œç‰©ä»¶é€²è¡ŒåŒæ­¥ï¼Ÿ

ä¸€æ—¦ä½ è™•ç†å¥½é€™äº›å•é¡Œï¼Œå…¶ä»–å•é¡Œå¯ä»¥è¢«ç°¡åŒ–ï¼Œç”šè‡³è¢«ä¸€ä½µè§£æ±ºã€‚æœ‰è¨±å¤šå¯èƒ½çš„æ–¹æ³•èƒ½è§£æ±ºé€™äº›å•é¡Œï¼Œä½†æˆ‘å€‘ä½¿ç”¨ä¸€ç¨®å¸¸è¦‹çš„è§£æ³•ï¼š**ä¸­å¿ƒåŒ–è³‡æ–™èˆ‡æ›´æ–°æ–¹å¼**ã€‚è³‡æ–™æµæœƒå‘ˆç¾ä¸‹åˆ—æ¨¡å¼ï¼š

![HTMLã€ä½¿ç”¨è€…è¡Œç‚ºèˆ‡ç¶²é ç‹€æ…‹çš„æ¶æ§‹åœ–](../images/data-flow.png)

> æˆ‘å€‘ä¸æœƒè™•ç†å¦‚ä½•è®“è³‡æ–™åŒæ­¥è§¸ç™¼é é¢çš„æ›´æ–°ï¼Œé€™æ¯”è¼ƒåƒæ˜¯é—œæ–¼[å›æ‡‰å¼ç¨‹å¼è¨­è¨ˆ](https://zh.wikipedia.org/wiki/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B)çš„æ›´é€²éšçŸ¥è­˜ã€‚ç•¶ä½ æ›´æ·±å…¥ç¶²é é–‹ç™¼é ˜åŸŸæ™‚ï¼Œé€™æ˜¯å€‹å¾ˆå¥½çš„ç™¼å±•æ–¹å‘ã€‚

âœ… æœ‰è¨±å¤šå‡½å¼åº«æä¾›ç‹€æ…‹ç®¡ç†çš„æ–¹å¼ï¼Œ[Redux](https://redux.js.org) å°±æ˜¯å¸¸è¦‹çš„é¸æ“‡ã€‚é–±è®€å®ƒçš„æ¦‚å¿µèˆ‡é‹ä½œæ¨¡å¼ï¼Œé€™æ˜¯ç¨®æœ‰æ•ˆçš„çš„å­¸ç¿’æ–¹å¼ï¼Œè®“ä½ åœ¨å¤§å‹çš„ç¶²é é–‹ç™¼ä¸­é æ¸¬æ½›åœ¨çš„é¢¨éšªï¼Œä¸¦é æƒ³è§£æ±ºæ–¹æ¡ˆã€‚

### èª²é¡Œ

æˆ‘å€‘æœƒå…ˆåšä¸€äº›ç¨‹å¼é‡æ§‹ã€‚æ›¿æ›æ‰ `account` çš„å®šç¾©ï¼š

```js
let account = null;
```

è®Šæˆï¼š

```js
let state = {
  account: null
};
```

é€™å€‹æ§‹æƒ³æ˜¯è¦*ä¸­å¿ƒåŒ–*æ‡‰ç”¨ç¨‹å¼è³‡æ–™åˆ°ä¸€å€‹ç‹€æ…‹ç‰©ä»¶ä¸­ã€‚ç›®å‰æˆ‘å€‘åªæœ‰ `account` åœ¨ç‹€æ…‹ä¸­ï¼Œä½†é€™èƒ½æä¾›æœªä¾†æ–°å¢æ–°åŠŸèƒ½çš„åŸºç¤ã€‚

æˆ‘å€‘é‚„éœ€è¦æ›´æ–°èˆ‡å®ƒç›¸é—œçš„å‡½å¼ã€‚åœ¨å‡½å¼ `register()` å’Œ `login()` ï¼Œå°‡ `account = ...` æ›¿æ›ç‚º `state.account = ...`ã€‚

åœ¨å‡½å¼ `updateDashboard()` çš„ä¸Šæ–¹ï¼ŒåŠ å…¥æ­¤è¡Œï¼š

```js
const account = state.account;
```

é€™å€‹é‡æ§‹ä¸¦ä¸æœƒå¸¶ä¾†ä»»ä½•æå‡ï¼Œä½†é€™æ˜¯ä¹‹å¾Œæ”¹è®Šä¸Šçš„åŸºç¤ã€‚
This refactoring by itself did not bring much improvements, but the idea was to lay out the foundation for the next changes.

## è¿½è¹¤è³‡æ–™æ”¹è®Š

ç¾åœ¨æˆ‘å€‘æœ‰ `state` ç‰©ä»¶å„²å­˜è³‡æ–™äº†ï¼Œæ¥ä¸‹ä¾†è¦ä¾†ä¸­å¿ƒåŒ–é€™äº›æ›´æ–°ã€‚ç›®æ¨™æ˜¯èƒ½è¼•æ˜“åœ°è¿½è¹¤ä»»ä½•è¢«è§¸ç™¼çš„æ”¹è®Šã€‚

ç‚ºäº†é¿å…æ”¹å‹• `state` ç‰©ä»¶ï¼Œæˆ‘å€‘è€ƒæ…®ä½¿å®ƒ[*ä¸å¯è®Š*](https://zh.wikipedia.org/wiki/%E4%B8%8D%E5%8F%AF%E8%AE%8A%E7%89%A9%E4%BB%B6)ï¼Œæ„å‘³è‘—å®ƒä¸èƒ½è¢«åšä»»ä½•çš„ä¿®æ”¹ã€‚
é€™ä¹Ÿä»£è¡¨ä½ å¿…é ˆå»ºç«‹æ–°çš„ç‹€æ…‹ç‰©ä»¶ä¾†æ›¿æ›å®ƒã€‚è—‰ç”±é€™å€‹æ–¹å¼ï¼Œä½ å°±æœ‰ä¸€å¥—ä¿è­·æªæ–½é˜»çµ•æ½›åœ¨éé æœŸ[é¢¨éšª](https://zh.wikipedia.org/wiki/%E5%89%AF%E4%BD%9C%E7%94%A8_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6))ï¼Œä¹Ÿé–‹å‰µå‡ºæ‡‰ç”¨ç¨‹å¼å…§é‚„åŸèˆ‡é‡åšçš„åŠŸèƒ½ï¼Œè®“ç¨‹å¼åµéŒ¯æ›´åŠ çš„å®¹æ˜“ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œä½ å¯ä»¥ç´€éŒ„ç‹€æ…‹çš„æ”¹è®Šï¼Œå„²å­˜ç‹€æ…‹çš„æ­·å²ç´€éŒ„ä¾†äº†è§£éŒ¯èª¤çš„ä¾†æºã€‚

åœ¨ JavaScript ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ [`Object.freeze()`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze) ä¾†å»ºç«‹ä¸å¯è®Šç‰©ä»¶ã€‚è‹¥ä½ æƒ³åœ¨ä¸å¯è®Šç‰©ä»¶ä¸Šåšæ›´å‹•ï¼Œä¾‹å¤–è™•ç†(exception)å°±æœƒç™¼ç”Ÿã€‚

âœ… ä½ çŸ¥é“*æ·ºè¤‡è£½(shallow)*å’Œ*æ·±è¤‡è£½(deep)*é€™å…©ç¨®ä¸å¯è®Šç‰©ä»¶çš„å·®åˆ¥å—ï¼Ÿä½ å¯ä»¥å¾[é€™è£¡](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze#What_is_shallow_freeze)é–±è®€ç›¸é—œè³‡è¨Šã€‚

### èª²é¡Œ

æˆ‘å€‘ä¾†å»ºç«‹æ–°çš„å‡½å¼ `updateState()`ï¼š

```js
function updateState(property, newData) {
  state = Object.freeze({
    ...state,
    [property]: newData
  });
}
```

åœ¨é€™å€‹å‡½å¼ä¸­ï¼Œæˆ‘å€‘æœƒå»ºç«‹æ–°çš„ç‹€æ…‹ç‰©ä»¶ï¼Œä¸¦åˆ©ç”¨[*å±•é–‹é‹ç®—å­(`...`)(Spread Operator)*](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/Spread_syntax#Spread_in_object_literals)è¤‡è£½å‰ä¸€å€‹è³‡æ–™ç‹€æ…‹ã€‚æ¥è‘—ï¼Œæˆ‘å€‘ä½¿ç”¨[æ‹¬å¼§è¨˜æ³•(Bracket Notation)](https://developer.mozilla.org/docs/Web/JavaScript/Guide/Working_with_Objects#Objects_and_properties) `[property]` è³¦äºˆä¸¦è¦†è“‹ç‰¹å®šçš„ç‹€æ…‹ç‰©ä»¶ã€‚æœ€å¾Œï¼Œæˆ‘å€‘ç‚ºç‰©ä»¶ä¸Šé–ï¼Œ`Object.freeze()` é¿å…ä»»ä½•çš„æ”¹å‹•ã€‚ç›®å‰æˆ‘å€‘åªæœ‰ `account` è³‡æ–™å­˜åœ¨ç‹€æ…‹ä¸­ï¼Œåˆ©ç”¨æ­¤æ–¹æ³•å¯ä»¥è®“ä½ æ–°å¢ä»»ä½•ä½ æƒ³è¦çš„è³‡æ–™ã€‚

æˆ‘å€‘æœƒæ›´æ–° `state` åˆå§‹åŒ–è¨­å®šï¼Œç¢ºä¿åˆå§‹ç‹€æ…‹ä¹Ÿè¢«ä¸Šé–ï¼š

```js
let state = Object.freeze({
  account: null
});
```

æ¥è‘—ï¼Œæ›´æ–°å‡½å¼ `register`ï¼Œå°‡ `state.account = result;` æ›¿æ›ç‚ºï¼š

```js
updateState('account', result);
```

åœ¨å‡½å¼ `login` ä¸Šåšä¸€æ¨£çš„äº‹ï¼Œå°‡ `state.account = data;` æ›¿æ›ç‚ºï¼š

```js
updateState('account', data);
```

è—‰ç”±é€™å€‹æ©Ÿæœƒï¼Œæˆ‘å€‘èƒ½è§£æ±ºå¸³æˆ¶è³‡æ–™åœ¨*ç™»å‡º*æ™‚ï¼Œä¸æœƒè¢«æ¸…é™¤çš„å•é¡Œã€‚

å»ºç«‹æ–°çš„å‡½å¼ `logout()`ï¼š

```js
function logout() {
  updateState('account', null);
  navigate('/login');
}
```

åœ¨ `updateDashboard()` ä¸­ï¼Œæ›¿æ›é‡æ–°å°å‘ `return navigate('/login');` ç‚º `return logout()`ã€‚

è©¦è‘—è¨»å†Šæ–°çš„å¸³æˆ¶ï¼Œç™»å…¥ç™»å‡ºä»¥ç¢ºä¿åŠŸèƒ½éƒ½é‹ä½œæ­£å¸¸ã€‚

> æç¤ºï¼šä½ å¯ä»¥è§€å¯Ÿæ‰€æœ‰çš„ç‹€æ…‹æ”¹è®Šï¼Œåœ¨ `updateState()` è£¡çš„æœ€ä¸‹æ–¹åŠ å…¥ `console.log(state)`ï¼Œé–‹å•Ÿç€è¦½å™¨é–‹ç™¼å·¥å…·ï¼Œå‘½ä»¤æ¬„å°±æœƒé¡¯ç¤ºç‹€æ…‹çš„ç´€éŒ„ã€‚

## ç´€éŒ„ç‹€æ…‹

å¤šæ•¸çš„ç¶²é æ‡‰ç”¨ç¨‹å¼éœ€è¦å„²å­˜è³‡æ–™ä»¥ç¢ºä¿é‹ä½œæ­£å¸¸ã€‚æ‰€æœ‰é‡è¦çš„è³‡æ–™éƒ½æœƒå­˜åœ¨è³‡æ–™åº«ä¸­ï¼Œä¸¦è—‰ç”±ä¼ºæœå™¨ API ä¾†å­˜å–ï¼Œå°±åƒæˆ‘å€‘å°ˆæ¡ˆä¸­çš„å¸³æˆ¶è³‡æ–™ã€‚ä½†æœ‰æ™‚å€™ï¼Œç€è¦½å™¨ç”¨æˆ¶ç«¯çš„æ‡‰ç”¨ç¨‹å¼ä¹Ÿéœ€è¦å„²å­˜ä¸€äº›è³‡æ–™ï¼Œæä¾›æ›´å¥½çš„ä½¿ç”¨è€…é«”é©—èˆ‡å¢é€²è² è¼‰æ•ˆèƒ½ã€‚

ç•¶ä½ æƒ³åœ¨ç€è¦½å™¨å…§å„²å­˜è³‡æ–™ï¼Œä½ å¿…é ˆæ€è€ƒå¹¾é …é‡è¦çš„å•é¡Œï¼š

- *é€™é …è³‡æ–™å¾ˆå±éšªå—ï¼Ÿ* ä½ æ‡‰è©²è¦é¿å…åœ¨ç”¨æˆ¶ç«¯å„²å­˜æ•æ„Ÿçš„è³‡æ–™ï¼Œä¾‹å¦‚å¸³æˆ¶å¯†ç¢¼ã€‚
- *ä½ éœ€è¦å„²å­˜è³‡æ–™å¤šä¹…ï¼Ÿ* ä½ æ‰“ç®—çŸ­æ™‚é–“å…§åšå­˜å–ï¼Œé‚„æ˜¯æ°¸ä¹…åœ°ä¿å­˜ï¼Ÿ

ç¶²é æ‡‰ç”¨ç¨‹å¼ä¸­æœ‰è¨±å¤šå„²å­˜è³‡è¨Šçš„æ–¹æ³•ï¼Œä¸€åˆ‡éƒ½å–æ±ºæ–¼ä½ æƒ³é”æˆçš„ç›®æ¨™ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œä½ å¯ä»¥åˆ©ç”¨ç¶²å€ä¾†å„²å­˜æœå°‹è³‡è¨Šï¼Œè®“ä½¿ç”¨è€…é–“èƒ½å…±äº«è³‡è¨Šã€‚è‹¥è³‡æ–™éœ€è¦èˆ‡ä¼ºæœå™¨å…±äº«ï¼Œå¥½æ¯”èªª[èªè­‰](https://zh.wikipedia.org/wiki/%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81)è³‡è¨Šï¼Œä½ å¯ä»¥ä½¿ç”¨ [HTTP cookies](https://developer.mozilla.org/docs/Web/HTTP/Cookies)ã€‚

å¦ä¸€å€‹é¸æ“‡æ˜¯ä½¿ç”¨å…¶ä¸­ä¸€å€‹å»£å¤§çš„ç€è¦½å™¨ API ä¾†å„²å­˜è³‡æ–™ã€‚ä¸‹åˆ—é€™å…©é …å°±ç‰¹åˆ¥æœ‰è¶£ï¼š

- [`localStorage`](https://developer.mozilla.org/docs/Web/API/Window/localStorage)ï¼š[Key/Value å„²å­˜æ³•](https://zh.wikipedia.org/wiki/%E9%94%AE-%E5%80%BC%E5%AD%98%E5%82%A8)å¯ä»¥ä¿å­˜ä¸åŒæ™‚åˆ»çš„ç¶²é è³‡æ–™ã€‚é€™äº›è³‡æ–™ä¸æœƒæœ‰æœŸé™çš„é™åˆ¶ã€‚
- [`sessionStorage`](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage)ï¼šå®ƒçš„é‹ä½œæ¨¡å¼èˆ‡ `localStorage` ç›¸åŒï¼Œåªå·®åœ¨è³‡æ–™æœƒåœ¨ç¶²é æ®µè½çµæŸæ™‚è¢«æ¸…é™¤ï¼Œå¦‚ç€è¦½å™¨é—œé–‰æ™‚ã€‚

ç´€éŒ„ä¸€ä¸‹é€™å…©å€‹ API åªèƒ½å„²å­˜[å­—ä¸²](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)æ ¼å¼ã€‚
å¦‚æœä½ æƒ³å„²å­˜æ›´è¤‡é›œçš„ç‰©ä»¶ï¼Œä½ éœ€è¦åˆ©ç”¨ [`JSON.stringify()`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) å°‡è³‡æ–™æ•´ç†æˆ [JSON](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON) æ ¼å¼ã€‚

âœ… å¦‚æœä½ æƒ³è¦å»ºç«‹ä¸ä»°è³´ä¼ºæœå™¨çš„ç¶²é æ‡‰ç”¨ç¨‹å¼ï¼Œä½ æœ‰è¾¦æ³•åœ¨ç”¨æˆ¶ç«¯å»ºç«‹è³‡æ–™åº«ã€‚[`IndexedDB` API](https://developer.mozilla.org/docs/Web/API/IndexedDB_API) å¯ä»¥æ‡‰ç”¨åœ¨æ›´é€²éšçš„æ¡ˆä¾‹ä¸Šï¼Œå„²å­˜æ›´å¤§é‡çš„è³‡æ–™ï¼Œç•¶ç„¶ä½¿ç”¨ä¸Šä¹Ÿç›¸å°è¤‡é›œã€‚

### èª²é¡Œ

æˆ‘å€‘æƒ³è®“ä½¿ç”¨è€…åœ¨ç™»å‡ºä¹‹å‰ï¼Œä¿æŒç™»å…¥ç‹€æ…‹ã€‚æ‰€ä»¥æˆ‘å€‘ä½¿ç”¨ `localStorage` ä¾†å„²å­˜å¸³æˆ¶è³‡æ–™ã€‚é¦–å…ˆï¼Œå®šç¾©ä¸€çµ„ key ä¾†ç´€éŒ„æˆ‘å€‘çš„è³‡æ–™å…§å®¹ã€‚

```js
const storageKey = 'savedAccount';
```

åœ¨å‡½å¼ `updateState()` æœ«ç«¯åŠ å…¥æ­¤è¡Œï¼š

```js
localStorage.setItem(storageKey, JSON.stringify(state.account));
```

è—‰ç”±æ­¤æ–¹å¼ï¼Œå¸³æˆ¶è³‡æ–™å°±èƒ½ä¿å­˜ä¸‹ä¾†ï¼Œä¸¦éš¨è‘—ä¹‹å‰ä¸­å¿ƒåŒ–å¾Œçš„ç‹€æ…‹è€Œæ›´æ–°ã€‚æˆ‘å€‘é–‹å§‹å¾ä¹‹å‰çš„é‡æ§‹ç²å–æ•ˆç›Šäº† ğŸ™‚ã€‚

ç•¶è³‡æ–™è¢«å„²å­˜å¾Œï¼Œæˆ‘å€‘é‚„éœ€è¦åœ¨ç¨‹å¼è®€å–æ™‚è¼‰å…¥è³‡æ–™ã€‚åœ¨ `app.js` ä¸‹æ–¹ç·¨å¯«æ›´å¤šçš„åˆå§‹åŒ–ç¨‹å¼ï¼Œå»ºç«‹æ–°çš„å‡½å¼ `init` ä¸¦æ”¶å…¥ä¹‹å‰çš„ç¨‹å¼ç¢¼ï¼š

```js
function init() {
  const savedAccount = localStorage.getItem(storageKey);
  if (savedAccount) {
    updateState('account', JSON.parse(savedAccount));
  }

  // ä¹‹å‰çš„åˆå§‹åŒ–ç¨‹å¼
  window.onpopstate = () => updateRoute();
  updateRoute();
}

init();
```

æˆ‘å€‘åœ¨æ­¤æ¥æ”¶äº†å„²å­˜è³‡æ–™ï¼Œä¸¦åŒæ­¥åœ°æ›´æ–°ç‹€æ…‹è³‡è¨Šã€‚é€™å¿…é ˆåœ¨æ›´æ–°è·¯ç”±*ä¹‹å‰*å®Œæˆï¼Œå¦å‰‡æœ‰äº›ç¨‹å¼ç¢¼æœƒåœ¨é é¢æ›´æ–°æ™‚ï¼Œä¾æ“šç‹€æ…‹ä¾†æ±ºå®šå…¶è¡Œç‚ºã€‚

ç•¶å„²å­˜å®Œå¸³æˆ¶è³‡æ–™å¾Œï¼Œæˆ‘å€‘ä¹Ÿå®šç¾©äº†*å„€è¡¨æ¿*é é¢ç‚ºæˆ‘å€‘çš„é è¨­é¦–é ã€‚è‹¥ç¨‹å¼æ²’æœ‰æ‰¾åˆ°è³‡æ–™ï¼Œå„€è¡¨æ¿é é¢ä¹Ÿèƒ½é‡æ–°å°å‘å›*ç™»å…¥*é é¢ã€‚åœ¨ `updateRoute()` ä¸­ï¼Œæ›¿æ›å›å‚³å€¼ `return navigate('/login');` ç‚º `return navigate('/dashboard');`ã€‚

ç™»å…¥æ‡‰ç”¨ç¨‹å¼ä¸¦é‡æ–°æ•´ç†é é¢ã€‚ä½ æ‡‰è©²èƒ½ç¶­æŒåœ¨å„€è¡¨æ¿é‚£é ã€‚é€™å€‹æ”¹è®Šä¹Ÿè§£æ±ºäº†æˆ‘å€‘æœ€åˆé¢è‡¨çš„å•é¡Œ......

## é‡æ•´è³‡æ–™

......ä½†æˆ‘å€‘å¯èƒ½ä¹Ÿç”¢ç”Ÿäº†æ–°å•é¡Œã€‚å•Šå‘€ï¼

ä½¿ç”¨ `test` å¸³æˆ¶é€²å…¥å„€è¡¨æ¿é é¢ï¼Œåœ¨çµ‚ç«¯æ©Ÿå…§åŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤ä»¥å»ºç«‹æ–°çš„äº¤æ˜“é …ç›®ï¼š

```sh
curl --request POST \
     --header "Content-Type: application/json" \
     --data "{ \"date\": \"2020-07-24\", \"object\": \"Bought book\", \"amount\": -20 }" \
     http://localhost:5000/api/accounts/test/transactions
```

è©¦è‘—é‡æ–°æ•´ç†ç€è¦½å™¨å…§å„€è¡¨æ¿é é¢ã€‚ç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼Ÿä½ æœ‰çœ‹åˆ°æ–°çš„äº¤æ˜“é …ç›®å—ï¼Ÿ

æ„Ÿè¬ `localStorage` çš„å¹«åŠ©ï¼Œç‹€æ…‹æˆåŠŸçš„å„²å­˜ä¸‹ä¾†ï¼Œä½†ä¹Ÿä»£è¡¨æˆ‘å€‘åœ¨ç™»å‡ºç™»å…¥ä¹‹å‰ï¼Œä¸èƒ½å†æ”¹è®Šå®ƒçš„å…§å®¹äº†ï¼

ä¸€å€‹å¯èƒ½çš„ä¿®å¾©ç­–ç•¥æ˜¯åœ¨å„€è¡¨æ¿è¼‰å…¥æ™‚ï¼Œé‡æ–°è¼‰å…¥å¸³æˆ¶è³‡è¨Šä»¥é¿å…è³‡æ–™ä¸åŒæ­¥ã€‚

### èª²é¡Œ

å»ºç«‹æ–°çš„å‡½å¼ `updateAccountData`ï¼š

```js
async function updateAccountData() {
  const account = state.account;
  if (!account) {
    return logout();
  }

  const data = await getAccount(account.user);
  if (data.error) {
    return logout();
  }

  updateState('account', data);
}
```

é€™å€‹æ–¹æ³•èƒ½æª¢æŸ¥æˆ‘å€‘æ˜¯å¦å·²ç¶“ç™»å…¥ï¼Œé‡æ–°å¾ä¼ºæœå™¨è¼‰å…¥ç”¨æˆ¶è³‡æ–™ã€‚

å»ºç«‹å¦ä¸€å€‹å‡½å¼ `refresh`ï¼š

```js
async function refresh() {
  await updateAccountData();
  updateDashboard();
}
```

é€™èƒ½æ›´æ–°å¸³æˆ¶è³‡æ–™ï¼Œæ›´æ–° HTML ä¸­çš„å„€è¡¨æ¿é é¢ã€‚é€™æ˜¯åœ¨å„€è¡¨æ¿è·¯ç”±è¢«è¼‰å…¥æ™‚ï¼Œæˆ‘å€‘æ‰€éœ€è¦å‘¼å«çš„å‡½å¼ã€‚æ›´æ–°è·¯ç”±å®šç¾©ç‚ºï¼š

```js
const routes = {
  '/login': { templateId: 'login' },
  '/dashboard': { templateId: 'dashboard', init: refresh }
};
```

è©¦è‘—é‡æ–°è¼‰å…¥å„€è¡¨æ¿ï¼Œå®ƒç¾åœ¨æ‡‰è©²èƒ½é¡¯ç¤ºæ›´æ–°å¾Œçš„å¸³æˆ¶è³‡æ–™ã€‚

---

## ğŸš€ æŒ‘æˆ°

æ¯ä¸€æ¬¡å„€è¡¨æ¿è¼‰å…¥æ™‚ï¼Œæˆ‘å€‘éƒ½æœƒé‡æ–°è¼‰å…¥å¸³æˆ¶è³‡æ–™ï¼Œä½ èªç‚ºæˆ‘å€‘é‚„éœ€è¦åœ¨ç”¨æˆ¶ç«¯å„²å­˜*æ‰€æœ‰çš„å¸³æˆ¶*è³‡æ–™å—ï¼Ÿ

è©¦è‘—æ”¹è®Š `localStorage` å…§çš„å„²å­˜å…§å®¹ï¼ŒåªåŒ…å«æˆ‘å€‘èƒ½é‹è¡Œç¨‹å¼çš„å¿…è¦è³‡æ–™ã€‚

## èª²å¾Œæ¸¬é©—

[èª²å¾Œæ¸¬é©—](https://ashy-river-0debb7803.1.azurestaticapps.net/quiz/48?loc=zh_tw)

## ä½œæ¥­

[ç·¨å¯«"åŠ å…¥äº¤æ˜“æ˜ç´°"è¦–çª—](assignment.zh-tw.md)

é€™é‚Šæœ‰å®Œæˆä¹‹å¾Œçš„çµæœï¼š

!["åŠ å…¥äº¤æ˜“æ˜ç´°"è¦–çª—çš„ä¾‹å­æˆªåœ–](../images/dialog.png)


export default ({ children }) => <div className="docs-content">{children}</div>;