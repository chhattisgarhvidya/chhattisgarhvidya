---
title: Construire un jeu spatial Partie 4: Ajouter un laser et dÃ©tecter les collisions
description: astuce: le laser avec lequel vous allez travailler est dÃ©jÃ  dans votre dossier assets et rÃ©fÃ©rencÃ© par votre code
lastUpdated: 2024-12-21T06:11:55.143Z
---

# Construire un jeu spatial Partie 4: Ajouter un laser et dÃ©tecter les collisions

## Quiz prÃ©alable

[Quiz prÃ©alable](https://ashy-river-0debb7803.1.azurestaticapps.net/quiz/35?loc=fr)

Dans cette leÃ§on, vous apprendrez Ã  tirer des lasers avec JavaScript! Nous ajouterons deux choses Ã  notre jeu:

- **Un laser**: ce laser est tirÃ© depuis le vaisseau de vos hÃ©ros et verticalement vers le haut
- **La dÃ©tection de collision**, dans le cadre de la mise en Å“uvre de la possibilitÃ© de *tirer*, nous ajouterons Ã©galement quelques rÃ¨gles de jeu intÃ©ressantes:
   - **Le laser frappe l'ennemi**: L'ennemi meurt s'il est touchÃ© par un laser
   - **Le laser touche l'Ã©cran supÃ©rieur**: un laser est dÃ©truit s'il touche la partie supÃ©rieure de l'Ã©cran
   - **Collision entre ennemis et hÃ©ros**: Un ennemi et le hÃ©ros sont dÃ©truits s'ils se frappent
   - **L'ennemi touche le bas de l'Ã©cran**: Un ennemi et un hÃ©ros sont dÃ©truits si l'ennemi touche le bas de l'Ã©cran

En bref, vous -- *le hÃ©ros* -- devez frapper tous les ennemis avec un laser avant qu'ils ne parviennent Ã  se dÃ©placer vers le bas de l'Ã©cran.

âœ… Faites une petite recherche sur le tout premier jeu vidÃ©o jamais Ã©crit. Quelle Ã©tait sa fonctionnalitÃ©?

Soyons hÃ©roÃ¯ques ensemble!

## La dÃ©tection de collision

Comment fait-on la dÃ©tection de collision? Nous devons penser Ã  nos objets de jeu comme des rectangles se dÃ©plaÃ§ant. Pourquoi vous pourriez vous demander? Eh bien, l'image utilisÃ©e pour dessiner un objet de jeu est un rectangle: il a un `x`, `y`, `width` et `height`.

Si deux rectangles, c'est-Ã -dire un hÃ©ros et un ennemi *se croisent*, vous avez une collision. Ce qui devrait arriver alors dÃ©pend des rÃ¨gles du jeu. Pour implÃ©menter la dÃ©tection de collision, vous avez donc besoin des Ã©lÃ©ments suivants:

1. Un moyen d'obtenir une reprÃ©sentation rectangulaire d'un objet de jeu, quelque chose comme Ã§a:

   ```javascript
   rectFromGameObject() {
     return {
       top: this.y,
       left: this.x,
       bottom: this.y + this.height,
       right: this.x + this.width
     }
   }
   ```

2. Une fonction de comparaison, cette fonction peut ressembler Ã  ceci:

   ```javascript
   function intersectRect(r1, r2) {
     return !(r2.left > r1.right ||
       r2.right < r1.left ||
       r2.top > r1.bottom ||
       r2.bottom < r1.top);
   }
   ```

## Comment dÃ©truire les objets

Pour dÃ©truire des objets dans un jeu, vous devez faire savoir au jeu qu'il ne doit plus afficher cet objet dans la boucle de jeu qui se dÃ©clenche Ã  un certain intervalle. Une faÃ§on de faire est de marquer un objet de jeu comme *mort* quand quelque chose se passe, comme ceci:

```javascript
// la collision s'est produite
enemy.dead = true
```

Ensuite, vous procÃ©dez au tri des objets *morts* avant de repeindre l'Ã©cran, comme ceci:

```javascript
gameObjects = gameObject.filter(go => !go.dead);
```

## Comment tirons-nous un laser

Tirer un laser se traduit par rÃ©pondre Ã  un Ã©vÃ©nement clÃ© et crÃ©er un objet qui se dÃ©place dans une certaine direction. Nous devons donc effectuer les Ã©tapes suivantes:

1. **CrÃ©ez un objet laser**: du haut du vaisseau de notre hÃ©ros, celui-ci commence Ã  se dÃ©placer vers le haut de l'Ã©cran lors de sa crÃ©ation.
2. **Attacher un code Ã  un Ã©vÃ©nement clÃ©**: nous devons choisir une touche du clavier qui reprÃ©sente le joueur tirant le laser.
3. **CrÃ©ez un objet de jeu qui ressemble Ã  un laser** lorsque la touche est enfoncÃ©e.

## Cooldown sur notre laser

Le laser doit se dÃ©clencher Ã  chaque fois que vous appuyez sur une touche, comme *espace* par exemple. Pour Ã©viter que le jeu ne produise trop de lasers en peu de temps, nous devons rÃ©soudre ce problÃ¨me. La solution consiste Ã  implÃ©menter un soi-disant *cooldown*(temps de recharge), une minuterie, qui garantit qu'un laser ne peut Ãªtre tirÃ© aussi souvent. Vous pouvez implÃ©menter cela de la maniÃ¨re suivante:

```javascript
class Cooldown {
  constructor(time) {
    this.cool = false;
    setTimeout(() => {
      this.cool = true;
    }, time)
  }
}

class Weapon {
  constructor {
  }
  fire() {
    if (!this.cooldown || this.cooldown.cool) {
      // produire un laser
      this.cooldown = new Cooldown(500);
    } else {
      // ne rien faire - il n'a pas encore refroidi.
    }
  }
}
```

âœ… Reportez-vous Ã  la leÃ§on 1 de la sÃ©rie de jeux spatiaux pour vous rappeler des *temps de recharge*

## Que construire

Vous allez prendre le code existant (que vous avez dÃ» nettoyer et refactoriser) de la leÃ§on prÃ©cÃ©dente et l'Ã©tendre. Commencez par le code de la partie II ou utilisez le code de la [partie III - dÃ©marreur](../../your-work).

> astuce: le laser avec lequel vous allez travailler est dÃ©jÃ  dans votre dossier assets et rÃ©fÃ©rencÃ© par votre code

- **Ajoutez la dÃ©tection de collision**, lorsqu'un laser entre en collision avec quelque chose, les rÃ¨gles suivantes doivent s'appliquer:
   1. **Le laser touche l'ennemi**: l'ennemi meurt s'il est touchÃ© par un laser
   2. **Le laser touche l'Ã©cran supÃ©rieur**: un laser est dÃ©truit s'il touche la partie supÃ©rieure de notre Ã©cran
   3. **Collision ennemi et hÃ©ros**: un ennemi et le hÃ©ros sont dÃ©truits s'ils se frappent
   4. **L'ennemi touche le bas de l'Ã©cran**: un ennemi et un hÃ©ros sont dÃ©truits si l'ennemi touche le bas de l'Ã©cran

## Ã‰tapes recommandÃ©es

Localisez les fichiers qui ont Ã©tÃ© crÃ©Ã©s pour vous dans le sous-dossier `your-work`. Il doit contenir les Ã©lÃ©ments suivants:

```bash
-| assets
  -| enemyShip.png
  -| player.png
  -| laserRed.png
-| index.html
-| app.js
-| package.json
```

Vous dÃ©marrez votre projet dans le dossier `your_work` en tapant:

```bash
cd your-work
npm start
```

Ce qui prÃ©cÃ¨de dÃ©marrera un serveur HTTP Ã  l'adresse `http://localhost:5000`. Ouvrez un navigateur et saisissez cette adresse, pour le moment, cela devrait rendre le hÃ©ros et tous les ennemis, rien ne bouge - pour le moment :).

### Ajouter un code

1. **Configurez une reprÃ©sentation rectangulaire de votre objet de jeu, pour gÃ©rer les collisions** Le code ci-dessous vous permet d'obtenir une reprÃ©sentation rectangulaire d'un `GameObject`. Modifiez votre classe GameObject pour l'Ã©tendre:

    ```javascript
    rectFromGameObject() {
        return {
          top: this.y,
          left: this.x,
          bottom: this.y + this.height,
          right: this.x + this.width,
        };
      }
    ```

2. **Ajouter du code qui vÃ©rifie la collision** Il s'agira d'une nouvelle fonction qui teste si deux rectangles se croisent:

    ```javascript
    function intersectRect(r1, r2) {
      return !(
        r2.left > r1.right ||
        r2.right < r1.left ||
        r2.top > r1.bottom ||
        r2.bottom < r1.top
      );
    }
    ```

3. **Ajouter une capacitÃ© de tir laser **
   1. **Ajouter un message d'Ã©vÃ©nement clÃ©**. La touche *espace* devrait crÃ©er un laser juste au-dessus du vaisseau hÃ©ros. Ajoutez trois constantes dans l'objet Messages:

       ```javascript
        KEY_EVENT_SPACE: "KEY_EVENT_SPACE",
        COLLISION_ENEMY_LASER: "COLLISION_ENEMY_LASER",
        COLLISION_ENEMY_HERO: "COLLISION_ENEMY_HERO",
       ```

   1. **Manipuler la touche espace**. Modifiez la fonction keyup `window.addEventListener` pour gÃ©rer les espaces:

      ```javascript
        } else if(evt.keyCode === 32) {
          eventEmitter.emit(Messages.KEY_EVENT_SPACE);
        }
      ```

    1. **Ajouter des auditeurs**. Modifiez la fonction `initGame()` pour vous assurer que le hÃ©ros peut se dÃ©clencher lorsque la barre d'espace est enfoncÃ©e:

       ```javascript
       eventEmitter.on(Messages.KEY_EVENT_SPACE, () => {
        if (hero.canFire()) {
          hero.fire();
        }
       ```

       et ajoutez une nouvelle fonction `eventEmitter.on()` pour assurer le comportement lorsqu'un ennemi entre en collision avec un laser:

          ```javascript
          eventEmitter.on(Messages.COLLISION_ENEMY_LASER, (_, { first, second }) => {
            first.dead = true;
            second.dead = true;
          })
          ```

   1. **DÃ©placez l'objet**, assurez-vous que le laser se dÃ©place progressivement vers le haut de l'Ã©cran. Vous allez crÃ©er une nouvelle classe Laser qui Ã©tend `GameObject`, comme vous l'avez fait auparavant: 
   
      ```javascript
        class Laser extends GameObject {
        constructor(x, y) {
          super(x,y);
          (this.width = 9), (this.height = 33);
          this.type = 'Laser';
          this.img = laserImg;
          let id = setInterval(() => {
            if (this.y > 0) {
              this.y -= 15;
            } else {
              this.dead = true;
              clearInterval(id);
            }
          }, 100)
        }
      }
      ```

   1. **GÃ©rer les collisions**, ImplÃ©menter les rÃ¨gles de collision pour le laser. Ajouter une fonction `updateGameObjects()` qui teste les objets en collision pour les hits

      ```javascript
      function updateGameObjects() {
        const enemies = gameObjects.filter(go => go.type === 'Enemy');
        const lasers = gameObjects.filter((go) => go.type === "Laser");
      // laser hit something
        lasers.forEach((l) => {
          enemies.forEach((m) => {
            if (intersectRect(l.rectFromGameObject(), m.rectFromGameObject())) {
            eventEmitter.emit(Messages.COLLISION_ENEMY_LASER, {
              first: l,
              second: m,
            });
          }
         });
      });

        gameObjects = gameObjects.filter(go => !go.dead);
      }  
      ```

      Assurez-vous d'ajouter `updateGameObjects()` dans votre boucle de jeu dans `window.onload`.

   4. **Mettez en place un temps de recharge (cooldown)** sur le laser, de sorte qu'il ne peut Ãªtre tirÃ© qu'un certain temps.

      Enfin, modifiez la classe de hÃ©ros afin qu'elle puisse se recharger:

       ```javascript
      class Hero extends GameObject {
        constructor(x, y) {
          super(x, y);
          (this.width = 99), (this.height = 75);
          this.type = "Hero";
          this.speed = { x: 0, y: 0 };
          this.cooldown = 0;
        }
        fire() {
          gameObjects.push(new Laser(this.x + 45, this.y - 10));
          this.cooldown = 500;
    
          let id = setInterval(() => {
            if (this.cooldown > 0) {
              this.cooldown -= 100;
            } else {
              clearInterval(id);
            }
          }, 200);
        }
        canFire() {
          return this.cooldown === 0;
        }
      }
      ```

Ã€ ce stade, votre jeu a quelques fonctionnalitÃ©s! Vous pouvez naviguer avec vos touches flÃ©chÃ©es, tirer un laser avec votre barre d'espace et les ennemis disparaissent lorsque vous les frappez. Bien jouÃ©!

---

## ðŸš€ Challenge

Ajoutez une explosion! Jetez un Å“il aux ressources du jeu dans [le rÃ©fÃ©rentiel Space Art](../../solution/spaceArt/readme.txt) et essayez d'ajouter une explosion lorsque le laser frappe un extraterrestre

## Quiz de validation des connaissances

[Quiz de validation des connaissances](https://ashy-river-0debb7803.1.azurestaticapps.net/quiz/36?loc=fr)

## RÃ©vision et Ã©tude personnelle

Faites des expÃ©riences avec les intervalles de votre jeu Ã  ce stade. Que se passe-t-il lorsque vous les modifiez? En savoir plus sur les [Ã©vÃ©nements de minutage JavaScript](https://www.freecodecamp.org/news/javascript-timing-events-settimeout-and-setinterval/).

## Affectation

[Explorer les collisions](assignment.fr.md)


export default ({ children }) => <div className="docs-content">{children}</div>;